@model IndexViewModel
@{
    ViewData["Title"] = "Manage your account";
}
<div class="manage-container">
    <h2>@ViewData["Title"].</h2>
    @{ string messageClass = string.Empty; }
    @if ((bool)ViewData["IsError"])
    {
        messageClass = "text-danger";
    }
    else
    {
        messageClass = "text-success";
    }
    <p class="@messageClass">@ViewData["StatusMessage"]</p>

    <div>
        <h4>Change your account settings</h4>
        <hr />
        <dl class="dl-horizontal">
            <dt>Cvarc tag:</dt>
            <dd>
                @if (Model.Team?.CvarcTag == null)
            {
                    @Guid.NewGuid()
                }
                else
                {
                    @Model.Team.CvarcTag
                }
            </dd>
            <hr />
            <dt>Password:</dt>
            <dd>
                @if (Model.HasPassword)
            {
                    <a asp-controller="Manage" asp-action="ChangePassword" class="btn-bracketed">Change</a>
                }
                else
                {
                    <a asp-controller="Manage" asp-action="SetPassword" class="btn-bracketed">Create</a>
                }
            </dd>
            <hr />
            <dt>Upload your solution: </dt>
            <dd>
                <form asp-controller="Manage" asp-action="UploadSolution" method="post" class="form-horizontal" enctype="multipart/form-data">
                    <div class="col-md-10">
                        <input type="file" name="Solution" id="solution-picker" class="btn btn-default" />
                        <button type="submit" class="btn btn-default">Upload</button>
                    </div>

                </form>
            </dd>
            <hr/>
            @if (@Model.MaxSize == 1 && !Model.CanOwnerLeave)
            {

            }
            else
            {
                if (Model.HasTeam)
                {
                    <dt>Your team:</dt>
                    <dd>Model.Team.Name</dd>
                    <form asp-controller="Teams" asp-action="LeaveTeam">
                        <input type="submit" value="Leave" />
                    </form>
                }
                else
                {
                    if (Model.RequestsInUserTeam.Any())
                    {
                        <dt>Requests to your team:</dt>
                        @foreach (var req in Model.RequestsInUserTeam)
                        {
                            <form asp-controller="Teams" asp-action="AcceptRequest" method="POST">
                                <span>User: @req.User.Team.Name</span>
                                <input type="text" style="display: none" value="@req.User.Team.OwnerId" />
                                <input type="submit" value="Accept request" />
                            </form>
                        }
                    }
                    if (Model.UserRequestsInOtherTeam.Any())
                    {
                        <dt>Request to team:</dt>
                        <dd>@Model.UserRequestsInOtherTeam.First().Team.Name</dd>
                    }
                    else
                    {

                        <form asp-controller="Teams" asp-action="CreateRequest" method="POST">
                            <dt>Request to join team:</dt>
                            <div class="col-md-10">
                                <input id="request-team" type="text" name="name" />
                                <input id="create-request" class="btn btn-default" type="submit" />
                            </div>
                        </form>

                    }
                }
            }
        </dl>

    </div>
</div>